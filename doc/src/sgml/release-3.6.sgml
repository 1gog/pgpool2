<!-- doc/src/sgml/release-3.6.sgml -->
<!-- See header comment in release.sgml about typical markup -->

<sect1 id="release-3-6">
  <title>Release 3.6</title>

  <note>
    <title>Release Date</title>
    <simpara>2016-11-xx</simpara>
  </note>

  <sect2>
    <title>Overview</title>

    <para>
      Major enhancements in <productname>Pgpool-II</productname> 3.6 include:
    </para>

    <!-- Items in this list summarize one or more items below -->

    <itemizedlist>

      <listitem>
	<para>
	  Improve the behavior of fail-over. In the steaming
	  replication mode, client sessions will not be disconnected
	  when a fail-over occurs any more if the session does not use
	  the failed standby server. If the primary server goes down,
	  still all sessions will be disconnected. Also it is possible
	  to connect to <productname>Pgpool-II</productname> even if
	  it is doing health checking retries. Before all attempt of
	  connecting to <productname>Pgpool-II</productname> failed
	  while doing health checking retries.
	</para>
      </listitem>

      <listitem>
	<para>
	  New PGPOOL SET command has been introduced. Certain
	  configuration parameters now can be changed on the fly in a
	  session.
	</para>
      </listitem>

      <listitem>
	<para>
	  Watchdog is significantly enhanced. It becomes more reliable
	  than previous releases.
	</para>
      </listitem>

      <listitem>
	<para>
	  Handling of extended query protocol (e.g. used by Java
	  applications) in streaming replication mode speeds up if
	  many rows are returned in a result set.
	</para>
      </listitem>

      <listitem>
	<para>
	  Import parser of PostgreSQL 9.6.
	</para>
      </listitem>

      <listitem>
	<para>
	  In some cases pg_terminate_backend() now does not trigger a
	  fail-over.
	</para>
      </listitem>

      <listitem>
	<para>
	  Change documentation format from raw HTML to SGML.
	</para>
      </listitem>

    </itemizedlist>

    <para>
      The above items are explained in more detail in the sections below.
    </para>

  </sect2>

  <sect2>
    <title>Enhancements</title>

    <itemizedlist>
      <listitem>
	<para>
      <!--
	  fail-over:
	  commit 9cc243a625ad17632c496bad8eb8a19e243f7385
	  Minimize the chance of session disconnection while failover

	  commit 259cdf99fc195713abdb5eb86a6a85bc81947c77
	  Do not restart child process if certain conditions met

	  commit 0d660326bde946e89f199dddb2ca3572ce785a0f
	  Allow to access to pgpool while doing health checking

	  SET command:
	  commit b9955cee5a01f1a898554190a778ac66632121d3
	  Adding new PGPOOL SET and PGPOOL RESET commands.

	  Speed up:
	  commit c0eb0ee5d23e1a95b27084fdf881faa6bc594e6d
	  Enhance performance of SELECT when lots of rows involved.

	  9.6 parser:
	  commit d768944b2a320e51cd2c3bc8dfbe6607a2306a46
	  import PostgreSQL 9.6 parser

	  pg_terminate_backend:
	  commit f284be467220cca09016b65ed7d07196b8f9fe3a
	  Handling of pg_terminate_backend for simple query protocol

      <listitem>
	    2016-03-15 [47d9af9] Mega patch to add SGML docs.
	<para>
          HTML documents are now generated from SGML documents. It is
          intended to have better construction, contents and
          maintainability. However, still there's tremendous room to
          enhance the SGML documents. Please help us!
	</para>
      </listitem>

	  misc:
	  commit 0f4d1deba03954666b270843c9237b7c48235547
	  Make authentication error message more user friendly.

	  commit 2088a17980747c22d15276f7132e8f0a455fe14e
	  Tighten up health check timer expired condition in pool_check_fd()

	  commit 879d16a1e0bee51ab5c4b732bdfa8ac9a965c408
	  Create regression log directory if it does not exist yet.

	  commit 6ff2ac0a512c858b580fedccae28fbf7db48b00f
	  Add new script called "watchdog_setup".

	  commit d3211dcdedbf649a5444fd06698a26f65bbbe0e1
	  Let watchdog_setup to be installed.

	  commit d5c3cf2d9d94534fd17b252f393d6e3a460a49b9
	  Let pgpool_setup install into dist bin.

	  commit cf319c48dadc907731190e4432e2c5d0925d5b2a
	  Add "-pg" option to pgpool_setup.

	  commit 9db83a8841925311f2e463e2bbeb875cf2bc158a
	  Add "replication delay" column to "show pool_nodes".

	  commit 270e445c5a977e16bfe8913585f6e8981a462877
	  Add regression test for bug 230.

	  commit 726cb5d3b18cc669c1eb63dcbce39a161a08b8f8
	  Do not update status file if all backend nodes are in down status.

	  commit 93424727fe97013686dabcb291a34d5686bb19e2
	  Permit pgpool to support multiple SSL cipher protocols

	  commit 25dc79e478c24aa884a7be3eb5bc2af51dc6f396
	  Adding new SHOW command for pgpool-II configuration parameters.

	  commit 0e01d3238bfb887a598fed1999a558cb9349bc64
	  removing the limit on the maximum number of items in the black_function_list and white_function_list lists.

	  commit f2a5081f0b115197c1321c5ffd1bf25c8318a065
	  Properly process empty query (all comments)

	  commit 342471f578290cb2c3426940f971253ff39be9de
	  Allow timeout value to be specified by the command option

	-->

	</para>
      </listitem>

    </itemizedlist>

  </sect2>

  <sect2>
    <title>Changes</title>

    <itemizedlist>

      <listitem>
	<para>
	  <!--
	      commit cc33fe3fd10493f16a481c622bfab53458b57d06
	      Change the default value of search_primary_node_timeout from 10 to 300.

	      commit 7671794bad592814de545dabfd6a36fd699466da
	      change the Makefile under this directory src/sql/,that is proposed by[pgpool-hackers: 1611]

	      commit 883d761b406ea156e96751aacdbb19d843905eb2
	      Change the PID length of pcp_proc_count command result to 6 characters long

	      commit 9b62eca4042ae5443a9bbbcdaa612ae86c7d8c91
	      Redirect all user queries to primary server

	    -->
	</para>
      </listitem>

    </itemizedlist>

  </sect2>

  <sect2>
    <title>Bug fixes</title>

    <itemizedlist>

      <listitem>
	<para>
	<!--
	    commit a7e459fa31204323df83e4a3df3135bf7d4634cd
	    Fix the case when all backends are down then 1 node attached.
	    commit e89e365aca82316f32cb76a16b782bdcaf44bee3
	    Fix for: [pgpool-general: 4997] Avoiding downtime when pgpool changes require a restart
	    commit 233ae462a417fb2d5919a2eac900b17348a7ca8b
	    Fixing a problem with the watchdog failover_command locking mechanism
	    commit 352bba0c539910cbe349f18f5fd1447c9a09fc5a
	    Fix wrong printf format specification.
	    commit b412da255932ec7af3c9ec92bec61b037a32ac31
	    Disable strict aliasing optimization.
	    commit 9a2c2302b380ad688400e1f42db7d72590e999e8
	    Fixing an obvious logic mistake.
	    commit 650c660a89df7ca4f5247dbc61e6a65ea63fc78b
	    Do not use random() while generating MD5 salt.
	    commit 455df3d586a64ecf2063cba1a84c72bedd0af6d5
	    Don't ignore sync message from frontend when query cache is enabled.
	    commit 4c23c9b84bcaac627c2cd03d740ddb549b2012f2
	    Fix for 237: Pgpool-II fails to start if listen_addresses is empty string
	    commit 879d16a1e0bee51ab5c4b732bdfa8ac9a965c408
	    Create regression log directory if it does not exist yet.
	    commit fe5ccb939b967aa802ddeeb170c890b4f97ff926
	    Fixing the error messages when the socket operation fails
	    commit f2b5d17e23bbd77bab7a3c3db6a1ad23b613e17e
	    Fix regression failure of 003.failover.
	    commit 0b99687ed8eef87b2b732e0ec333354ca5a2c46a
	    Unbreak version 2 protocol case.
	    commit a7bc4c85d08e0ef36b290278d4c3809d5a44ba22
	    Fix hang when portal suspend received
	    commit 3b2db66c3a10444cb31d3f6285d6bf09994d167c
	    Fix for 228: pgpool doesn't de-escalate IP in case network restored
	    commit 9b122ab04c6e3f2fad41883dcdc991886499154e
	    SIGUSR1 signal handler should be installed before watchdog initialization.
	    commit bda946e718fe6f3605eb7e82ada8754bd84a279c
	    Fix for 218: Inconsistent status of Postgresql nodes in pgPool instances
	    commit 024eaeaa0fea3cd5acda4c41d791835887e11d02
	    Fix for 215: pgpool doesnt escalate ip in case of another node inavailability
	    commit 5bce300c491f44d44551f8812dc79d1166bf45ff
	    Fixing a coding mistake in watchdog code.
	    commit 541451eab2647151aa8c04a1e1a1fe9e42f2dd7e
	    Display human readable output for backend node status.
	    commit 3cbce4eaf870e89fdd8f8a2ad8fab8d3d8aadf65
	    Replace "MAJOR" macro to prevent occasional failure.
	    commit 866575c8fe89da2127a6c1bb19746b03b61bbfd4
	    Fix for  [pgpool-hackers: 1501]  kind does not match error
	    commit 680e3297f1d6c58810889ccf54a0614617739e7b
	    Fix handling of pcp_listen_addresses config parameter.
	    commit e245587de0dd967fefacb960976ab29a1ba0ac4f
	    Save and restore errno in each signal handler.
	    commit 0d1cdf96feb77de6f1dfc2d46ecd7467325d1f79
	    Fix usage of wait(2) in pgpool main process
	    commit bb41a1e55d59f842d8b97cdbb6c973c1989904aa
	    Fix confusing error messages.
	    commit a01624f498700026f75b445988fd18ab6d3a8fe9
	    Fix buffer over run problem in "show pool_nodes".
	    commit 4c63d102dc192b14215a83e0e86ac45cf78145c3
	    Fixing [pgpool-hackers: 1638] pgpool-II does not use default configuration
	    commit 226a21b19f6a59fe72599d84b4eed9185a0fa1f5
	    Fix bug with load balance node id info on shmem
	    commit 6ae42e74d48391b8cfaa97927e00bd65aec68fe8
	    fix for 0000197: pgpool hangs connections to database..
	    commit 294cf4aa4d5a3b9489d33b29d04a5ea9b8cf6d89
	    Fix a posible hang during health checking
	    commit a2d04ab99b8be678053106a4449c512c5bb74e04
	    Deal with the case when the primary is not node 0 in streaming replication mode.
	    commit 69d3faef778782ebf7c7a3f9914492825216f88a
	    If statement timeout is enabled on backend and do_query() sends a query to primary node, and all of following user queries are sent to
	    standby, it is possible that the next command, for example END, could
	    cause a statement timeout error on the primary, and a kind mismatch
	    error on pgpool-II is raised.
	    commit 0c0e727348f81b2d4fc273dceda6b64ed9463dbb
	    Fix extended protocol handling in raw mode
	    commit 78c5d56ba7d226370540205e030a8a35284bf4bd
	    Fix confusing comments in pgpool.conf
	    commit 27a38dc9b070607e0735feb461cd5c0a19f6493e
	    Fix Chinese documetation bug about raw mode
	    commit de905f672281e65ac2897475b3dc926ec28b7bfd
	    Fix documetation bug about raw mode
	    commit 95129999b0f04b4e1446e34f44a6ae99466885d6
	    Fix is_set_transaction_serializable() when SET default_transaction_isolation TO 'serializable'.
	    commit a5fdf78e6e86c5a8a1d4ce5b1eb273a59f5ecfb9
	    Fix extended protocol hang with empty query
	    commit 64696fd839da70e6fd8daacd73da11b6e8a1f1c9
	    Fix for [pgpool-general: 4569] PGPoolII-3.5 : segfault
	    commit f7723c89c7e925194f0da6154d9798a97b273026
	    Validating the PCP packet length
	    commit 39e07ea13a7f318f2c50a8aec7baa93e13a347d3
	    Fix extended query hangs
	    commit f305fbe0355529d4142d3b76e08f7d08dc2c3cf9
	    Fix pgpool hang bug (deal with bug 167)
	    commit d1c03f2efa25cc8d633d989d54a0cb1f074e448b
	    Fix pgpool_setup to not confuse log output
	    commit e55c230d674ea221c09e8266a68d119f1a3a2dac
	    Fix for [pgpool-general: 4519] Worker Processes Exit and Are Not Re-spawned
	    commit 67ac541d879b9a96353216b793ce954088e5ff06
	    Fix pgpool hung after receiving error state from backend
	    commit bb295a22ad47001758b0b38968f53c776f439f2f
	    Fix query stack problems in extended protocol case.
	    commit 63a0b7042b4b3d90336d8ed2c868861868178e71
	    Fix yet another reset query stuck problem
	    commit f1cfeb69a8557caf5d16dca5cdae0a3cad743e8c
	    Yet another reset query stuck problem fix. [pgpool-general: 4265]
	    commit c50f3579e92296ad57f71c4ab900f8521de1c7b1
	    Fixing pgpool-recovery module compilation issue with PostgreSQL 9.6
	    commit 48e9d4b028bdfefc9cca4e3f1f9d700b36cff294
	    Fix for [pgpool-II 0000166]: compile issue on freebsd
	    commit 6688332daa90d8578e64084d95339dfdbf5c6b30
	    Fix regression test to check timeout of each test
	    commit 44f43cc4799383a2049859bb47f89eb786549cd5
	    Add some warning messages for wd_authkey hash calculation failure
	  -->
	</para>
      </listitem>

    </itemizedlist>

  </sect2>

</sect1>
